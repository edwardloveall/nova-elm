<?xml version="1.0" encoding="UTF-8"?>
<syntax name="elm">
    <meta>
        <name>Elm</name>
        <type>compiled</type>
        <preferred-file-extension>elm</preferred-file-extension>
    </meta>
    
    <detectors>
        <extension priority="1.0">elm</extension>
    </detectors>
    
    <comments>
        <single>
            <expression>--</expression>
        </single>
        
        <multiline>
            <starts-with>
                <expression>{-</expression>
            </starts-with>
            <ends-with>
                <expression>-}</expression>
            </ends-with>
        </multiline>
    </comments>
    
    <brackets>
        <pair open="{" close="}" />
        <pair open="[" close="]" />
        <pair open="(" close=")" />
    </brackets>
    
    <surrounding-pairs>
        <pair open="{" close="}" />
        <pair open="[" close="]" />
        <pair open="(" close=")" />
        <pair open="&quot;" close="&quot;" />
    </surrounding-pairs>
    
    <indentation>
        <increase>
            <expression>(case|if|else|let|-&gt;).*</expression>
        </increase>
        <decrease>
            <expression>^\s+(in)\b|\s+</expression>
        </decrease>
    </indentation>
    
    <scopes>
        <include syntax="self" collection="comments" />
        <include syntax="self" collection="keywords" />
        <include syntax="self" collection="types" />
        <include syntax="self" collection="functions" />
        <include syntax="self" collection="values" />
        <include syntax="self" collection="syntax" />
    </scopes>

    <collections>
        <!-- Comments -->
        <collection name="comments">
            <scope name="elm.comment.single" spell-check="true">
                <expression>(--)(.*)$</expression>
                <capture number="1" name="elm.punctuation.definition.begin" />
                <capture number="2" name="elm.comment.content" />
            </scope>
            
            <scope name="elm.comment.multiline" spell-check="true">
                <symbol type="comment">
                    <context behavior="subtree" />
                </symbol>
                <starts-with>
                    <expression>{-</expression>
                    <capture number="0" name="elm.punctuation.definition.begin" />
                </starts-with>
                <ends-with>
                    <expression>-}</expression>
                    <capture number="0" name="elm.punctuation.definition.end" />
                </ends-with>
            </scope>
        </collection>
        
        <!-- Keywords -->
        <collection name="keywords">
            <include syntax="self" collection="punctuation" />
            <scope name="elm.keyword">
                <symbol type="keyword" />
                <strings>
                    <string>alias</string>
                    <string>as</string>
                    <string>case</string>
                    <string>else</string>
                    <string>exposing</string>
                    <string>if</string>
                    <string>import</string>
                    <string>in</string>
                    <string>let</string>
                    <string>module</string>
                    <string>of</string>
                    <string>port</string>
                    <string>then</string>
                    <string>type</string>
                </strings>
            </scope>
        </collection>
        
        <!-- Functions -->
        <collection name="functions">         
            <!-- Signature -->
            <scope name="elm.functions.signature">
                <symbol type="function" scope="global">
                    <context behavior="subtree" foldable="false" />
                </symbol>
                <starts-with>
                    <expression>^(port\s+)?([a-z][A-Za-zÀ-ÖØ-öø-ÿ0-9]*)\s+(\:)</expression>
                    <capture number="1" name="elm.keyword" />
                    <capture number="2" name="elm.identifier.function.name" />
                    <capture number="3" name="elm.keyword" />
                </starts-with>
                <ends-with>
                    <expression>(?=^\S)</expression>
                </ends-with>
                <subscopes>
                    <include syntax="self" collection="comments" />
                    <include syntax="self" collection="keywords" />
                    <include syntax="self" collection="strings" />
                    <include syntax="self" collection="types" />
                </subscopes>
            </scope>
            
            <!-- Function -->
            <scope name="elm.functions.block">
                <symbol type="function" scope="global">
                    <context behavior="subtree" foldable="false" />
                </symbol>
                <starts-with>
                    <expression>^(?| ([a-z][A-Za-zÀ-ÖØ-öø-ÿ0-9]*))</expression>
                    <capture number="1" name="elm.identifier.function.name" />
                </starts-with>
                <ends-with>
                    <expression>(?=^\S)</expression>
                </ends-with>
                <subscopes>
                    <include syntax="self" collection="comments" />
                    <include syntax="self" collection="keywords" />
                    <include syntax="self" collection="strings" />
                    <include syntax="self" collection="types" />
                </subscopes>
            </scope>
        </collection>
        
        <!-- Values -->
        <collection name="values">
            <include syntax="self" collection="strings" />
            <scope name="elm.value.boolean">
                <strings>
                    <string>True</string>
                    <string>False</string>
                </strings>
            </scope>
            <scope name="elm.value.number.integer">
                <expression>\b-?\d+\b</expression>
            </scope>
            <scope name="elm.value.number.float">
                <expression>(-?)(\b\d+\.\d*|\.\d+)</expression>
                <capture number="1" name="elm.operator" />
                <capture number="2" name="elm.value.number.float.real" />
            </scope>
        </collection>
        
        <!-- Strings -->
        <collection name="strings">
            <scope name="elm.string.single-quoted">
                <starts-with>
                    <expression>&apos;</expression>
                    <capture number="0" name="elm.string.single-quoted.delimiter" />
                </starts-with>
                <ends-with>
                    <expression>&apos;</expression>
                    <capture number="0" name="elm.string.single-quoted.delimiter" />
                </ends-with>
            </scope>
            <scope name="elm.string.double-quoted">
                <starts-with>
                    <expression>&quot;</expression>
                    <capture number="0" name="elm.string.double-quoted.delimiter" />
                </starts-with>
                <ends-with>
                    <expression>&quot;</expression>
                    <capture number="0" name="elm.string.double-quoted.delimiter" />
                </ends-with>
            </scope>
        </collection>
        
        <!-- Syntax -->
        <collection name="syntax">
            <scope name="elm.bracket">
                <expression>[\(\[\)\]]</expression>
            </scope>
            <scope name="elm.operator">
                <expression>(\+ | \- | \* | \+\+ | \^ | \/ | \/\/ | \=\= | \/\= | &lt; | &gt; | &lt;&lt; | &gt;&gt; | &lt;\= | &gt;\= | &amp;&amp; | \|\|)</expression>
            </scope>
        </collection>
    
        <!-- Types -->
        <collection name="types">
            <scope name="elm.type">
                <expression>\b([A-ZÀ-Ö][a-zA-ZÀ-ÖØ-öø-ÿ0-9]*)</expression>
                <capture number="1" name="elm.identifier.type.name" />
            </scope>
        </collection>
        
        <!-- Punctuation -->
        <collection name="punctuation">
            <scope name="elm.punctuation">
                <expression>(\|&gt; | &lt;\| | \. | \= | \_ | \\ | \| | \-&gt; | \:)</expression>
                <capture number="1" name="elm.keyword" />
            </scope>
        </collection>
    </collections>
</syntax>
